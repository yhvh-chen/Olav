# Device Inspection (设备巡检)

## 适用场景
- 定期健康检查
- 上线前检查
- 故障后复查
- 变更前后对比

## 识别标志
用户问题包含: "巡检"、"检查"、"健康检查"、"baseline"

## 执行策略
1. **使用 write_todos 列出检查项**
2. 按模板逐项执行
3. 生成结构化报告
4. 标记异常项

## 巡检模板

### 基础信息
- [ ] `show version` (运行时间、版本、型号)
- [ ] `show inventory` (硬件信息、模块)
- [ ] `show license` (许可证状态)

### 系统健康
- [ ] `show processes cpu history` (CPU 趋势)
- [ ] `show memory statistics` (内存使用)
- [ ] `show environment all` (温度、电源、风扇)

### 接口状态
- [ ] `show interfaces summary` (端口状态汇总)
- [ ] `show interfaces counters errors` (错误计数)
- [ ] `show interfaces status` (详细状态)

### 路由状态
- [ ] `show ip route summary` (路由汇总)
- [ ] `show ip ospf neighbor` (OSPF 邻居)
- [ ] `show ip bgp summary` (BGP 邻居)

### 二层状态
- [ ] `show vlan brief` (VLAN 状态)
- [ ] `show spanning-tree summary` (STP 状态)
- [ ] `show lldp neighbors` (LLDP 邻居)

### 安全检查
- [ ] `show access-lists summary` (ACL 配置)
- [ ] `show login` (登录配置)
- [ ] `show users` (当前会话)

## 报告格式

### 执行摘要
```
设备巡检报告 - R1 (10.1.1.1)
检查时间: 2026-01-07 14:30:00
运行时间: 45 days, 6 hours

总体状态: ⚠️  2项异常
```

### 详细结果
| 检查项 | 状态 | 详情 | 建议 |
|--------|------|------|------|
| CPU | ✅ 正常 | 平均 15%, 峰值 25% | - |
| 内存 | ⚠️ 警告 | 使用 85% | 考虑升级内存 |
| Gi0/1 | ❌ 异常 | CRC错误: 1234 | 检查光模块 |
| OSPF | ✅ 正常 | 3个邻居全UP | - |
| BGP | ✅ 正常 | 2个邻居全UP | - |

### 异常详情
```
❌ 内存使用率过高
当前: 85%
阈值: >80%
建议: 监控趋势，考虑升级内存

❌ 接口 Gi0/1 CRC错误
错误计数: 1234
增长率: +10/分钟
建议: 检查光模块和线缆
```

## 快速巡检 vs 深度巡检

### 快速巡检 (Quick Check)
只检查关键指标:
- CPU/内存
- 接口状态
- 路由汇总
- 关键日志

**时间**: 2-3分钟
**适用**: 日常监控

### 深度巡检 (Full Inspection)
完整模板检查
**时间**: 10-15分钟
**适用**: 月度/季度检查

## 对比分析

### 变更前后对比
```
变更: 升级IOS版本
变更前: v17.3.1a
变更后: v17.3.2

指标对比:
- CPU: 20% → 18% ✅
- 内存: 75% → 78% ⚠️
- 错误率: 0.01% → 0% ✅

结论: 升级成功，性能略有改善
```

### 历史趋势
```
内存使用趋势 (最近7天):
Mon: 75% | Tue: 76% | Wed: 77% | Thu: 78%
Fri: 79% | Sat: 80% | Sun: 85% ⚠️

趋势: 上升
预测: 3天内可能达到90%
```

## 巡检自动化

### 批量巡检
对多台设备执行相同检查:
```
1. list_devices(role="core")
2. 对每台设备执行巡检模板
3. 生成汇总报告
4. 标记异常设备
```

### 定期巡检
建议:
- 核心设备: 每天快速巡检
- 汇聚设备: 每周快速巡检
- 接入设备: 每月深度巡检

## 输出示例
```
==========================================
设备巡检报告
==========================================
设备: R1 (10.1.1.1)
平台: cisco_ios
时间: 2026-01-07 14:30:00
运行时间: 45 days

检查结果: 12项 ✅, 2项 ⚠️, 1项 ❌

异常项:
1. ❌ Gi0/1 CRC错误 (1234个)
2. ⚠️ 内存使用率 85%

详细报告已保存到: knowledge/inspections/R1_20260107.md
==========================================
```
