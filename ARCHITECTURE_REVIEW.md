# OLAV v0.8 æ¶æ„é…ç½®é‡å®¡

## é—®é¢˜å›é¡¾

ç”¨æˆ·æå‡ºçš„å››ä¸ªå…³é”®é—®é¢˜ï¼š
1. NETCONF æ˜¯å¦å·²æ·˜æ±°ï¼ˆé‡‡ç”¨å‘½ä»¤ç™½åå•æ¨¡å¼ï¼‰ï¼Ÿ
2. OLAV_MODEï¼ˆQuickTest/Productionï¼‰æ˜¯å¦æœ‰å¿…è¦ï¼Ÿ
3. NetBox å½“å‰é˜¶æ®µæ˜¯å¦çœŸçš„éœ€è¦ï¼Ÿ
4. DeepAgents æŒä¹…åŒ–ä¼šè¯åº”è¯¥ç”¨ä»€ä¹ˆæ•°æ®åº“ï¼ˆSQLite vs DuckDBï¼‰ï¼Ÿ

---

## 1ï¸âƒ£ NETCONF æ¶æ„åˆ†æ

### ç°çŠ¶

**DESIGN_V0.8.md ä¸­çš„è¯´æ³•**:
```
- æ”¯æŒ CLI | REST API | NETCONF | gRPC ç­‰å¤šç§åè®®
- YANGLoader è®¡åˆ’ç”¨äº NETCONF (*.yang)
- NETCONF ä½œä¸ºå¯é€‰çš„æ•°æ®è·å–æ–¹å¼
```

**å½“å‰å®ç°**:
```python
# config/settings.py
netconf_port: int = 830  # NETCONF ç«¯å£é…ç½®
```

### åˆ†æ

âœ… **NETCONF ä»æœ‰æ„ä¹‰çš„æƒ…å†µ**:
- éœ€è¦é€šè¿‡ NETCONF è·å–ç»“æ„åŒ–é…ç½®æ•°æ®
- æŸäº›é«˜ç«¯ç½‘ç»œè®¾å¤‡ï¼ˆASRã€CSRï¼‰ä½¿ç”¨ NETCONF/YANG æ¨¡å‹

âŒ **NETCONF å·²æ·˜æ±°çš„æƒ…å†µ**:
- åªæ‰§è¡Œå‘½ä»¤ç™½åå•ï¼ˆä¸éœ€è¦ NETCONFï¼‰
- ä¸éœ€è¦ç»“æ„åŒ–é…ç½®è§£æï¼ˆJSON/YAML è¶³å¤Ÿï¼‰
- CLI show å‘½ä»¤ + æ­£åˆ™æå– è¶³ä»¥æ»¡è¶³éœ€æ±‚

### å»ºè®®

**ä¸¤ç§æ¨¡å¼é€‰æ‹©**:

**é€‰é¡¹ A**ï¼ˆå½“å‰ï¼‰ï¼šä¿ç•™ NETCONF æ”¯æŒ
```python
# ä¿ç•™ netconf_port é…ç½®ï¼Œä½†æ ‡è®°ä¸ºå¯é€‰
netconf_port: int = 830  # å¯é€‰ï¼Œä»…å½“éœ€è¦ NETCONF æŸ¥è¯¢æ—¶ä½¿ç”¨
```
- ä¼˜ç‚¹ï¼šçµæ´»ï¼Œæœªæ¥å¯æ‰©å±•åˆ°ç»“æ„åŒ–é…ç½®
- ç¼ºç‚¹ï¼šå¯¹äºåˆæœŸåªåšå‘½ä»¤ç™½åå•çš„éœ€æ±‚æ˜¯è¿‡åº¦è®¾è®¡

**é€‰é¡¹ B**ï¼ˆæ¨èï¼‰ï¼šå…ˆç§»é™¤ï¼Œåç»­æŒ‰éœ€åŠ å›
```python
# æš‚æ—¶ç§»é™¤ netconf_port
# NETCONF éœ€æ±‚åœ¨ Phase 2+ å†åŠ å…¥
```
- ä¼˜ç‚¹ï¼šMVP ä¿æŒç®€æ´ï¼Œèšç„¦å‘½ä»¤ç™½åå•
- ç¼ºç‚¹ï¼šåç»­éœ€è¦é‡æ–°æ·»åŠ 

**æˆ‘çš„å»ºè®®**: é€‰æ‹© **Option B** - å…ˆç§»é™¤ netconf_portï¼Œå› ä¸ºï¼š
- è®¾è®¡æ–‡æ¡£ä¸­ NETCONF æ˜¯ã€Œè®¡åˆ’ä¸­ã€(ğŸ”œ)ï¼Œä¸æ˜¯ MVP
- CLI å‘½ä»¤ç™½åå•å·²ç»è¶³å¤Ÿåº”å¯¹å½“å‰éœ€æ±‚
- å‡å°‘åˆæœŸé…ç½®å¤æ‚åº¦

---

## 2ï¸âƒ£ OLAV_MODE å¿…è¦æ€§åˆ†æ

### ç°çŠ¶

```python
olav_mode: Literal["QuickTest", "Production"] = "QuickTest"
```

### é—®é¢˜

**è¿™ä¸ªé…ç½®åœ¨ DESIGN_V0.8.md ä¸­æ²¡æœ‰æåˆ°è¿‡**ï¼Œè¿™è¯´æ˜ï¼š
1. å¯èƒ½æ˜¯ä» v0.5 é—ç•™ä¸‹æ¥çš„æ¦‚å¿µ
2. æ²¡æœ‰æ˜ç¡®çš„ä½¿ç”¨åœºæ™¯

### åˆ†æ

**å¯èƒ½çš„ç”¨é€”**:
- QuickTestï¼šè·³è¿‡æŸäº›éªŒè¯ã€ä½¿ç”¨ mock æ•°æ®
- Productionï¼šå®Œæ•´çš„æ£€æŸ¥ã€çœŸå®æ•°æ®

**é—®é¢˜**:
- DeepAgents ä¸­æ²¡æœ‰ç›¸åº”çš„ã€Œæ¨¡å¼ã€æ¦‚å¿µ
- å½“å‰é…ç½®ä¸­æ²¡æœ‰ä»»ä½•ä»£ç åœ¨è¯»å–è¿™ä¸ªå€¼
- å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ›´æ¸…æ¥šåœ°è¡¨è¾¾æ„å›¾

### å»ºè®®

âŒ **ç§»é™¤ OLAV_MODE**ï¼Œç†ç”±ï¼š
1. æ²¡æœ‰ä»£ç ä½¿ç”¨è¿™ä¸ªé…ç½®
2. è®¾è®¡æ–‡æ¡£ä¸­æ²¡æœ‰æåˆ°
3. å¯ä»¥é€šè¿‡å…¶ä»–æœºåˆ¶å®ç°ï¼ˆå¦‚ç¯å¢ƒå˜é‡ `ENVIRONMENT`ï¼‰

âœ… **ç”¨ ENVIRONMENT æ›¿ä»£**ï¼Œæ›´æ¸…æ™°ï¼š
```python
environment: Literal["local", "development", "production"] = "local"
```

è¿™ä¸ªå­—æ®µå®é™…ä¸Šå·²ç»åœ¨ config/settings.py ä¸­äº†ï¼

**å»ºè®®**: 
- ç§»é™¤ `olav_mode`
- ç”¨ `environment` ä»£æ›¿ï¼ˆå·²ç»å­˜åœ¨ï¼‰
- ç»Ÿä¸€è§„åˆ™ï¼šlocal/dev/prod å¯¹åº”ä¸åŒçš„æ—¥å¿—çº§åˆ«ã€éªŒè¯ä¸¥æ ¼ç¨‹åº¦

---

## 3ï¸âƒ£ NetBox å½“å‰éœ€è¦å—ï¼Ÿ

### ç°çŠ¶

```python
netbox_url: str = ""
netbox_token: str = ""
netbox_verify_ssl: bool = True
netbox_device_tag: str = "olav-managed"
```

### åˆ†æ

**å½“å‰é˜¶æ®µçš„å®é™…æƒ…å†µ**:
- å‘½ä»¤ç™½åå•å·²å®šä¹‰ï¼ˆåœ¨ `.olav/imports/commands/` ä¸­ï¼‰
- ä¸éœ€è¦ä» NetBox åŠ¨æ€åŠ è½½èƒ½åŠ›
- Device credentials å¯ä»¥ç¡¬ç¼–ç æˆ–é€šè¿‡ SSH config

**NetBox çš„çœŸæ­£ä»·å€¼**:
- âœ… Phase 2+ éœ€è¦ï¼šåŠ¨æ€è®¾å¤‡å‘ç°å’Œç®¡ç†
- âœ… åº“å­˜å˜æ›´æ—¶è‡ªåŠ¨æ›´æ–°æ‰§è¡Œç›®æ ‡
- âœ… CMDB é›†æˆ

**å½“å‰ MVP æ˜¯å¦éœ€è¦**:
- âŒ ä¸æ˜¯å¿…éœ€çš„

### å»ºè®®

**ä¸¤ç§é€‰æ‹©**:

**A. ä¿ç•™é…ç½®**ï¼ˆæ¨èï¼‰
```python
# ä¿ç•™ NetBox é…ç½®ï¼Œä½†æ ‡è®°ä¸ºã€Œå¯é€‰ã€
netbox_url: str = ""  # å¯é€‰ï¼ŒPhase 2+ éœ€è¦
```
- ä¼˜ç‚¹ï¼šè®¾è®¡æå‰è€ƒè™‘ï¼Œè¿‡æ¸¡å¹³æ»‘
- ç¼ºç‚¹ï¼šæœªä½¿ç”¨çš„é…ç½®å®¹æ˜“é€ æˆæ··æ·†

**B. å®Œå…¨ç§»é™¤**
```python
# æš‚æ—¶ç§»é™¤ï¼ŒPhase 2 å†åŠ å›
```
- ä¼˜ç‚¹ï¼šMVP ç®€æ´
- ç¼ºç‚¹ï¼šåç»­åŠ å›æ—¶æœ‰é¢å¤–å·¥ä½œ

**æˆ‘çš„å»ºè®®**: é€‰æ‹© **A**ï¼ŒåŸå› ï¼š
- è®¾è®¡æ–‡æ¡£ä¸­æ˜ç¡®æåˆ°ã€ŒSingle Source of Truthã€
- è™½ç„¶ MVP ä¸ç”¨ï¼Œä½†ä¿ç•™é…ç½®ä¾¿äºæ–‡æ¡£å®Œæ•´æ€§
- ç”¨æ³¨é‡Šè¯´æ˜è¿™æ˜¯ã€ŒPhase 2+ åŠŸèƒ½ã€

---

## 4ï¸âƒ£ DeepAgents æŒä¹…åŒ–ä¼šè¯ï¼šSQLite vs DuckDB

è¿™æ˜¯æœ€å…³é”®çš„æ¶æ„é—®é¢˜ã€‚

### å½“å‰çŠ¶æ€

**DESIGN_V0.8.md ä¸­çš„è¯´æ³•**:
```python
# MVP: ä½¿ç”¨å†…å­˜å­˜å‚¨ (ç®€å•å¯é )
checkpointer = MemorySaver()

# æœªæ¥ (Phase 5+): è€ƒè™‘ PostgreSQL æŒä¹…åŒ–
# checkpointer = PostgresSaver.from_conn_string(POSTGRES_URL)
```

**æˆ‘ä»¬çš„ config/settings.py ä¸­**:
```python
duckdb_path: str = str(OLAV_DIR / "capabilities.db")
```

### é—®é¢˜é™ˆè¿°

**DuckDB çš„é™åˆ¶**:
- DuckDB è®¾è®¡ç”¨äº **OLAP**ï¼ˆåˆ†æå‹ï¼‰æŸ¥è¯¢
- LangGraph Checkpointer éœ€è¦ **OLTP**ï¼ˆäº‹åŠ¡å‹ï¼‰æ“ä½œ
- DuckDB ä¸æ”¯æŒè¡Œçº§é”ï¼Œå¹¶å‘æ€§èƒ½å·®
- ä¸é€‚åˆ Checkpointer çš„é¢‘ç¹è¯»å†™

**SQLite çš„ä¼˜åŠ¿**:
- è®¾è®¡ç”¨äº **OLTP** æ“ä½œ
- æ”¯æŒå®Œæ•´çš„äº‹åŠ¡å’Œé”æœºåˆ¶
- LangGraph æœ‰åŸç”Ÿ SqliteSaverï¼ˆä½†éœ€è¦ langchain-community >= 0.0.1ï¼‰
- å•è¿›ç¨‹ã€é›¶é…ç½®ã€æ–‡ä»¶æœ¬åœ°å­˜å‚¨

### å¯¹æ¯”åˆ†æ

| ç‰¹æ€§ | DuckDB | SQLite | PostgreSQL |
|------|--------|--------|-----------|
| è®¾è®¡ç›®æ ‡ | OLAPï¼ˆåˆ†æï¼‰ | OLTPï¼ˆäº‹åŠ¡ï¼‰ | OLTPï¼ˆäº‹åŠ¡ï¼‰ |
| å¹¶å‘æ€§ | âŒ å·® | âœ… å¥½ | âœ… å¥½ |
| æ–‡ä»¶å­˜å‚¨ | âœ… æ˜¯ | âœ… æ˜¯ | âŒ å¦ |
| æ— ä¾èµ– | âœ… æ˜¯ | âœ… æ˜¯ | âŒ å¦ |
| LangGraph Saver | âŒ æ—  | âœ… SqliteSaver | âœ… PostgresSaver |
| MVP é€‚ç”¨æ€§ | âŒ å¦ | âœ… æ˜¯ | âš ï¸  è¿‡åº¦è®¾è®¡ |

### å»ºè®®æ¶æ„

```python
# MVP (Phase 1-2): å†…å­˜ + å¯é€‰ SQLite
from langgraph.checkpoint.memory import MemorySaver
from langgraph.checkpoint.sqlite import SqliteSaver

# å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨å†…å­˜å­˜å‚¨ï¼ˆç®€å•ï¼‰
checkpointer = MemorySaver()

# ç”Ÿäº§ç¯å¢ƒï¼šå¯é€‰ SQLite æŒä¹…åŒ–
if settings.environment == "production":
    checkpointer = SqliteSaver(
        db_path=str(OLAV_DIR / "checkpoints.db")
    )

# Phase 3+: å¦‚éœ€åˆ†å¸ƒå¼ï¼Œå†è€ƒè™‘ PostgreSQL
```

### é…ç½®å˜æ›´å»ºè®®

```python
# æ›¿æ¢å½“å‰çš„ DuckDB æ¦‚å¿µï¼š

# âœ… ä¿ç•™ DuckDB ç”¨äºèƒ½åŠ›åº“ï¼ˆOLAPï¼‰
duckdb_path: str = str(OLAV_DIR / "capabilities.db")  # å­˜å‚¨å‘½ä»¤ã€APIã€NETCONF èƒ½åŠ›

# âœ… æ–°å¢ SQLite ç”¨äºä¼šè¯æŒä¹…åŒ–ï¼ˆOLTPï¼‰
checkpoint_db_path: str = str(OLAV_DIR / "checkpoints.db")  # å­˜å‚¨ Agent ä¼šè¯çŠ¶æ€

# âœ… ç§»é™¤ PostgreSQL é…ç½®ï¼ˆMVP ä¸éœ€è¦ï¼‰
# ä¿ç•™ PostgreSQL è¿æ¥ç”¨äºæœªæ¥åˆ†å¸ƒå¼åœºæ™¯ (Phase 3+)
```

---

## æ€»ç»“å»ºè®®

### ğŸ”§ é…ç½®ç³»ç»Ÿåº”è¯¥ä¿®æ”¹ä¸ºï¼š

```python
# ä¿ç•™
âœ… LLM é…ç½®ï¼ˆopenai/ollama/azureï¼‰
âœ… Embedding é…ç½®
âœ… DuckDB èƒ½åŠ›åº“ï¼ˆ.olav/capabilities.dbï¼‰
âœ… SQLite Checkpointsï¼ˆ.olav/checkpoints.dbï¼‰
âœ… NetBox é…ç½®ï¼ˆæ ‡è®°ä¸º Phase 2+ï¼‰
âœ… Network Device é…ç½®

# ç§»é™¤
âŒ netconf_port ï¼ˆç§»åˆ° Phase 2+ï¼‰
âŒ olav_mode ï¼ˆç”¨ environment æ›¿ä»£ï¼‰
âŒ PostgreSQL é…ç½® ï¼ˆç§»åˆ° Phase 3+ï¼‰
âŒ Redis é…ç½® ï¼ˆå·²ç§»é™¤ï¼‰
âŒ OpenSearch é…ç½® ï¼ˆå·²ç§»é™¤ï¼‰

# ä¿ç•™ä½†æ”¹è¿›
âš ï¸  environment: local/development/production ï¼ˆç”¨æ¥æ›¿ä»£ olav_modeï¼‰
```

### ğŸ“Š æ•°æ®åº“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         OLAV v0.8 æ•°æ®åº“æ¶æ„                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  DuckDB (.olav/capabilities.db)             â”‚
â”‚  â”œâ”€ å­˜å‚¨ï¼šå‘½ä»¤ç™½åå•ã€API ç«¯ç‚¹ã€NETCONF    â”‚
â”‚  â”œâ”€ ç”¨é€”ï¼šOLAP æŸ¥è¯¢ï¼ˆåˆ†æå‹ï¼‰              â”‚
â”‚  â”œâ”€ æ“ä½œï¼šAgent è¯»å–èƒ½åŠ›ï¼ˆå†™é¢‘ç‡ä½ï¼‰       â”‚
â”‚  â””â”€ ç‰¹ç‚¹ï¼šå¿«é€ŸæŸ¥è¯¢å¤§æ•°æ®é›†                  â”‚
â”‚                                             â”‚
â”‚  SQLite (.olav/checkpoints.db)              â”‚
â”‚  â”œâ”€ å­˜å‚¨ï¼šAgent ä¼šè¯çŠ¶æ€ã€å¯¹è¯å†å²          â”‚
â”‚  â”œâ”€ ç”¨é€”ï¼šOLTP æ“ä½œï¼ˆäº‹åŠ¡å‹ï¼‰              â”‚
â”‚  â”œâ”€ æ“ä½œï¼šé¢‘ç¹è¯»å†™æ›´æ–°                      â”‚
â”‚  â””â”€ ç‰¹ç‚¹ï¼šæ”¯æŒäº‹åŠ¡ã€å¹¶å‘å®‰å…¨                â”‚
â”‚                                             â”‚
â”‚  å†…å­˜ (MemorySaver)                         â”‚
â”‚  â”œâ”€ å­˜å‚¨ï¼šå½“å‰ä¼šè¯çš„å¯¹è¯è®°å½•                â”‚
â”‚  â”œâ”€ ç”¨é€”ï¼šå¿«é€Ÿè®¿é—®                         â”‚
â”‚  â”œâ”€ ç‰¹ç‚¹ï¼šè¿›ç¨‹ç»“æŸåä¸¢å¤±                    â”‚
â”‚  â””â”€ ç”¨äºï¼šå¼€å‘æµ‹è¯•ï¼ˆç”Ÿäº§ç¯å¢ƒç”¨ SQLiteï¼‰    â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âœ… æœ€ç»ˆæ¸…å•

- [ ] ç§»é™¤ `netconf_port` é…ç½®
- [ ] ç§»é™¤ `olav_mode` é…ç½®  
- [ ] ä¿ç•™ `environment` é…ç½®ï¼ˆæ›¿ä»£ olav_modeï¼‰
- [ ] ä¿ç•™ `netbox_*` é…ç½®ï¼Œæ·»åŠ æ³¨é‡Šè¯´æ˜ä¸º Phase 2+
- [ ] æ·»åŠ  `checkpoint_db_path: str` ç”¨äº SQLite Checkpointer
- [ ] æ›´æ–° .env.example ç§»é™¤ NETCONF_PORT å’Œ OLAV_MODE
- [ ] æ›´æ–° .env åŒæ­¥ä¿®æ”¹
- [ ] æ›´æ–° config/settings.py åŒæ­¥ä¿®æ”¹

---

**å†³ç­–**: é‡‡çº³ä»¥ä¸Šå»ºè®®ï¼Œä½¿ v0.8 MVP æ›´åŠ ç²¾ç®€å’Œèšç„¦ã€‚
