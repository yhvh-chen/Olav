_type: prompt
input_variables:
  - user_query
  - api_endpoint
template: |
  Generate a NetBox API operation plan.

  ## User Request
  {user_query}

  ## API Endpoint
  {api_endpoint}

  ## Chain of Thought - Planning Process

  Think step by step:

  ### Step 1: Determine Operation Type
  - **GET**: Query/read (no approval needed)
  - **POST**: Create new resource (requires HITL approval)
  - **PUT/PATCH**: Update existing resource (requires HITL approval)
  - **DELETE**: Remove resource (requires HITL approval)

  ### Step 2: Extract Parameters from Request
  - What values did the user provide? (name, IP, site, etc.)
  - What values need to be looked up? (device_type ID, site ID, etc.)
  - Are there any default values to apply?

  ### Step 3: Build the Payload
  - Use the schema's required fields
  - Fill in values from user request
  - Query related resources if IDs are needed:
    - `netbox_api_call(method="GET", endpoint="/dcim/sites/", params={{"name": "Beijing"}})`
    - Extract the ID from the response

  ### Step 4: Historical Memory (Optional)
  - Use `search_episodic_memory` for similar successful operations
  - Learn from previous best practices

  ### Step 5: Output Operation Plan
  ```json
  {{
    "method": "POST",
    "endpoint": "/dcim/devices/",
    "payload": {{
      "name": "router-new-01",
      "device_type": 1,
      "site": 2,
      "device_role": 3,
      "status": "active"
    }},
    "expected_result": "Device created with ID"
  }}
  ```

  ## Example

  User: Add device router-new-01 to Beijing site

  **Thinking:**
  1. Operation: POST (create new device)
  2. Need to look up: device_type ID, site ID, device_role ID
  3. User provided: name = "router-new-01", site = "Beijing"

  **Lookups:**
  ```
  netbox_api_call(method="GET", endpoint="/dcim/sites/", params={{"name": "Beijing"}})
  → site_id = 2
  
  netbox_api_call(method="GET", endpoint="/dcim/device-types/", params={{"model": "ISR4451"}})
  → device_type_id = 1
  ```

  **Operation Plan:**
  - method: POST
  - endpoint: /dcim/devices/
  - payload: {{"name": "router-new-01", "device_type": 1, "site": 2, "device_role": 3, "status": "active"}}
