# OLAV Fluent Bit Configuration
# Receives Syslog from network devices and forwards to OpenSearch
#
# Replaces rsyslog for better OpenSearch 2.x compatibility
# Supports UDP/TCP syslog on port 514

[SERVICE]
    Flush         5
    Daemon        Off
    Log_Level     info
    Parsers_File  parsers.conf
    HTTP_Server   On
    HTTP_Listen   0.0.0.0
    HTTP_Port     2020

# Syslog UDP Input (standard)
[INPUT]
    Name          syslog
    Tag           syslog.udp
    Mode          udp
    Listen        0.0.0.0
    Port          514
    Parser        syslog-rfc3164
    Buffer_Chunk_Size 32k
    Buffer_Max_Size   64k

# Syslog TCP Input (reliable delivery)
[INPUT]
    Name          syslog
    Tag           syslog.tcp
    Mode          tcp
    Listen        0.0.0.0
    Port          514
    Parser        syslog-rfc3164
    Buffer_Chunk_Size 32k
    Buffer_Max_Size   64k

# Add metadata fields
[FILTER]
    Name          modify
    Match         syslog.*
    Add           log_source network_device
    Add           collector fluent-bit

# Rename fields for OpenSearch compatibility
[FILTER]
    Name          nest
    Match         syslog.*
    Operation     lift
    Nested_under  data

# Output to OpenSearch
[OUTPUT]
    Name            opensearch
    Match           syslog.*
    Host            opensearch
    Port            9200
    Index           syslog-raw
    Suppress_Type_Name On
    Logstash_Format Off
    Time_Key        @timestamp
    Time_Key_Format %Y-%m-%dT%H:%M:%S
    Retry_Limit     5
    Buffer_Size     512KB
    Generate_ID     On

# Debug output to stdout (optional, disable in production)
[OUTPUT]
    Name            stdout
    Match           syslog.*
    Format          json_lines
